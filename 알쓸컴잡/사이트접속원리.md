# google.com을 입력하고 엔터를 치면 일어나는 일들
------------작성중-------------
라우터끼리 계속 연결된 것을 인터넷이라고함?
결국 어떻든간에 전선이 필요함. 그래서 실제로 떨어진 나라끼리는 엄청 굵은 해저 전선들로 연결되어있음
# 토막상식
1. 큰 네트워크부터 작은 네트워크까지 연결하는 거대한 네트워크가 인터넷. 
2. WAN은 ISP가 제공하는 서비스를 사용하여 구축된다. 범위가 넓으므로 당연히 LAN보다 느리고 오류 발생확률도 높다.
3. 인터넷 공유기(broadband router)는 router를 가정용으로 만든 것으로, 다양한 역할 하긴 하지만 일단 router와 같은것으로 취급되지는 않는 다는 것에 주의
4. DMZ: 공개서버. 주로 웹서버, 메일서버, DNS서버를 일컫는다.
# 네트워크도 아키텍처가 있다
네트워크는 대표적인 Layered Architecture 시스템이다.
# TCP/IP는 업데이트 되었다
원래 TCP/IP는 4계층이었다. link, internet, transport, application이었으나 업데이트되면서 physical, data link, network, transport, application으로 바뀌었으며 1~4계층은 osi7과 공유하게 되었다. 오늘날 대부분의 프로토콜이 TCP/IP 기반으로 동작하므로 네트워크도 TCP/IP기반으로 설명하는 것이 훨씬 현실적이다.

# TCP/IP 소켓 프로그래밍
운영체제의 transport layer에서 제공하는 API를 활용해서 통신가틍한 프로그램을 만드는 것을 TCP/IP 소켓 프로그래밍 혹은 네트워크 프로그래밍이라고 칭함. TCP/IP소켓프로그래밍을 통해 누구나 자신만의 application layer 인코더와 디코더를 작성할 수 있다. 즉 누구나 application layer 프로토콜(HTTP등)을 만들어 사용할 수 있다는 것이다.
# OSI 7 layer적 관점
어찌되었든 OSI 7레이어를 통해 네트워크를 이해해보자
## 1계층: physical layer(bit)
하드웨어가 역할 수행
시스템간의 물리적인 연결과 전기신호를 변환 및 제어한다.
1계층에서 데이터를 아날로그 신호로 변경(인코딩) -> 다음 목적지의 1계층에서 아날로그 신호를 데이터로 변경(디코딩) -> ... 과정 반복

## 2계층: data link(frame)
2계층도 하드웨어적으로 구현되어있음(랜카드). 
같은 네트워크에 있는 여러 대의 컴퓨터들이 데이터를 주고 받기 위한 모듈
네트워크 기기 간의 데이터 전송 및 물리 주소를 결정한다.

## 3계층: network(packet)
컴퓨터가 목적지의 IP주소를 이용해 경로를 찾고(routing) 다음 라우터에게 데이터를 넘겨주는(forwarding)계층. 패킷은 목적지 주소 붙은 세그먼트라고 생각하면 된다. (라우팅의 원리 추가 공부 필요. 어떻게 목적지를 향해 가는지?)

대역폭을 적게 차지하기 위해 데이터를 나눠 패킷으로 보내는 것. 패킷 도착에는 순서가 없다. 그러나 각 패킷에는 순서를 식별할 수 있는 정보가 포함되므로 수신처에서 온전한 데이터로 구성가능.
근데 운영체제의 커널에 소프트웨에적으로 구현되어있다고? 왜? 하드웨어아니야? 라우터라매
다른 네트워크와 통신하기 위한 경로 설정및 논리주소를 결정한다.
## 4계층: transport(segment)
수신 컴퓨터의 프로세스의 포트번호를 붙여서 보내야 한다. 여러 요청이 동시에 하나의 컴퓨터로 들어와도 각각의 프로세스에 보낼 수 있어야하니까. well-known 포트들을 사용할때가 많으므로 잘 인식을 못할 뿐. 
운영체제의 커널에 소프트웨어적으로 구현
신뢰할 수 있는 통신을 구현한다.
## 5계층: session(data)
세션 체결, 통신 방식을 결정한다.
## 6계층: presentation(data)
문자 코드, 압축, 암호화 등 데이터를 변환한다.
## 7계층: application(data)
이메일 & 파일 전송, 웹 사이트 조회 등 애플리케이션에 대한 서비스를 제공한다
## 1. IP 주소 획득
URL(아마 도메인 네임을 입력했을 것)을 입력하면 그 도메인 네임을 사용하는 IP주소를 찾아내기위해 DNS 서버에 우선 접속한다. 계층적인 DNS(이는 DNS적인 내용이므로 여기서는 생략)질의를 마친 후 IP주소가 반환된다. 그러나 효율성을 위하여 컴퓨터는 보통 매번 DNS에 질의하는 것이 아니라 host 파일을 지니고 도메인 네임이 일치하는 IP주소가 있는지부터 검색한다. host파일에서 값을 찾지 못했을 경우, DNS 응답을 캐시해둔 DNS Cache를 탐색해 이전에 응답받은 값이 있는지를 찾아낸다. DNS Cache도 존재하지 않을 경우, 질의를 수행하는데 질의는 다시 두 가지로 나뉜다. 컴퓨터의 네트워크 설정에 따라, 공유기에게 우선적으로 질의하여 IP를 획득할 수도 있다(DNS Forwarding: 공유기가 직접 DNS에게 질의). 
공유기를 사용하지 않는다면 ISP가 제공해준 DNS설정을 쓰도록 되어있다. 

## 2. TCP 연결
HTTP를 아마도 쓰게 될 것인데, HTTP는 TCP에서 동작하므로 컴퓨터와 목적지가 TCP연결을 수행한다(ACK-SYN). TCP연결이 완료되면 HTTP 요청을 보낸다. 이후 응답이 돌아온다.

## 3. Naver, Google과 같은 거대 회사들은 GSLB와 CDN을 활용한다(중요)
## 3-1. 그럼 GSLB(Global Service Load Balancing)가 무엇인가?
일단 GSLB의 목적부터 알아보자. GSLB는 헬스체크를 통해 disaster recovery(접속 불가능으로 판별되면 자동 우회 -> 접속 가능한 서버로 배정), 부하분산, 클라이언트의 위치 혹은 네트워크를 기반으로 최적의 성능을 낼 서버를 자동으로 선택해준다. 

### GSLB vs DNS
|분류|GSLB|DNS|  
|---|---|---|  
|재해복구|헬스체크 실패한 서버는 IP응답에서 제외|서버의 상태를 알 수 없으므로 접속에 실패하는 유저 발생|  
|로드밸런싱|서버의 부하를 모니터링하여 부하가 적은 서버 IP반환|단순 RR|  
|레이턴시 기반 서비스|지역별로 나뉘어진 latency정보를 가지므로 가장 적은 latency 서버로 연결|단순 RR|  
|위치 기반 서비스|유저 지역 정보를 기반으로 해당 지역 서버로 연결|단순 RR|

### GSLB 주요 개념
#### Health check
- 등록된 호스트들에 대하여 주기적 헬스체크 실행
- 헬스체크가 실패할 경우 DNS응답에서 제외
#### TTL
- DNS에서 권한을 가진 
#### 네트워크 거리 & 위치
- 주기적으로 성능을 측정하고 그 기록을 저장
- DNS 질의에 대하여 지리적으로 혹은 네트워크적으로 가까운 서버를 반환
- 지리적으로 가까운 서버는 네트워크 거리 또한 가까울 확률이 높음

### GSLB 동작원리
1. 클라이언트가 도메인(www.abc.com)을 입력하면 Local DNS는 상위 DNS로 DNS 질의를 요청 합니다. DNS 질의를 전달받은 Root DNS, .com DNS는 해당 질의를 'abc.com' DNS 서버로 전달합니다. abc.com DNS 서버는 사전에 등록 된 www에 대한 CNAME 정보가 GSLB로 지정 되어 있기 때문에 DNS 질의는 최종적으로 GSLB에 전달됩니다.
2. GSLB(abc.g.ucloudbiz.com)에서는 요청 받은 DNS질의에 대해 그림과 같이 1.1.1.1[Active]와 2.2.2.2[Backup] 서버 리스트를 가지고 있습니다.
3. GSLB는 [Active]로 지정 된 1.1.1.1 IP주소를 반환해주며, [Active] 서버가 비 정상일 경우에 Backup 서버 주소인 2.2.2.2를 반환합니다.
4. Local DNS는 반환 받은 IP 주소를 클라이언트에 알려줍니다.
5. 클라이언트는 최종적으로 반환 받은 IP 주소로 접속하여 서비스를 제공 받습니다

## 3-2. CDN이란?
내용이 너무 길어지는 관계로 아카마이의 CDN개념 설명 페이지로 대체한다.  
https://www.akamai.com/ko/our-thinking/cdn/what-is-a-cdn

어떻게 알수 있는가? nslookup www.naver.com 해보면 이름에 akamaiedge라고 뜬다. CDN쓰고 있다는 소리다. akamai뿐아니라 KT등의 회사도 CDN 서비스를 제공한다. CDN을 사용하는 이유는

