# 나는 테스트를 잘하는가?
아니다. 지금부터 써내려갈 글은 나에 대한 따끔한 충고의 의미로 작성하는 것이다. 테스트에 관한 고찰을 해보며 나는 지금껏 얼마나 의미없는 테스트 작성에 시간을 쏟아왔는지 깨달을 수 있었다. 혹시 다른 누군가가 이 글을 볼 수 있다면, 나와 같은 실수를 반복하지 않길 바라는 마음으로 작성한다.

# Private 메서드에 대한 테스트는 필요한가
간단하게, Private에 대한 테스트는 필요하지 않다 라고 정의하고 넘어갈 수도 있지만 좀 더 복잡하게 코너 케이스를 따져보고 싶다. 

Private메서드는 언제나 테스트가 필요 없는가?
-> 의문이 든다. private이 거대하거나 의존 관계가 상세하여 테스트가 필요할 수도 있지 않은가?

아니 애초에 Private 메서드는 왜 존재하는 것인가?

객체간의 관계, 은닉, 추상 인터페이스를 통한 소통 등 여러 이야기들이 떠오르지만 일단 테스트에서 private을 테스트할 필요 없는 이유는 private은 public의 break down들이어야하기 때문이라고 압축된다. public이 정상적으로 작동하면 private이 정상적으로 작동한다고 추론 할 수 있다는 것이다. 어떤 객체의 private를 테스트하려는 시도 자체가 encapsulation을 해치는 행위이다. 

질문(private 메서드는 언제나 테스트가 필요없는가?)으로 돌아가서 생각해보자. 독립된 테스트가 필요한 private 메서드가 정상일까부터 생각해봐야할 것 같다. 언제나 잘못 되었다고 단정 짓는 것은 위험한 생각인 것 같고, 설계가 잘못 되었거나 충분히 break down되지 않았다는 신호일 가능성이 있을 것이다. 특히 결합도가 높아서 테스트가 필요하다? 심히 잘못된 설계일 것이다. 

그러나 테스트가 필요한 private이 언제나 잘 못 된 것일 수는 없지 않을까? 그럴땐 그 private이 public인 또다른 객체를 주입받는 객체로 재작성 하는 것은 어떨까? 예를 들어, A 클래스 내에 테스트가 필요한 private 메서드인 PA는 A에서는 Private으로 그대로 유지된채 B 클래스로 분리되어 B 클래스에서는 public이면 되지 않을까? A의 encapsulation을 해치지도 않으니 추상 인터페이스도 해치지 않는다. 다만 A와 B클래스간의 인터페이스는 추가되어야 할 것이다.

## 그렇다면 Private Method에 대한 테스트는 작성이 금지되는가?
당연히 아니다. 개발자는 자신의 개발 효율을 위해 어떤 테스트던 작성할 자유가 있다. 도구가 주인행세를 하려하는 월권 행위를 방치하면 안된다.

그러나, 정의된 추상 인터페이스에서 벗어난 테스트는 남겨져서는 안된다. 이것이 핵심이다.

테스트 코드는 내가 green을 보려고 작성하는 것이 아니다. 대부분의 경우, 테스트 코드는 조직의 효율성을 극대화 시키는 역할을 한다. 테스트 코드는 단지 작성된 코드의 작동을 보장하는 것 뿐만 아니라 타인에게 이 코드의 역할을 설명할 수 있는 좋은 설명서가 된다. 

Red -> Green -> Refactoring(TDD by Kent beck)사이클을 따르며 코드가 완성되어 갈때에는 private에 대한 테스트가 작성될 수 있다. 그러나 결국 코드가 완성되었을때 private에 대한 테스트가 남겨져있을 자리는 없다. 앞서 언급했듯 encapsulation와 interface에 혼동을 주는 행위이며, 그럴 필요도 없다.

여기까지 생각해보면, TC(test case)의 역할 자체에 대해 좀더 분명하게 바라볼 수 있을 것 같다. 테스트는 구체적 모듈에 관심이 없다. 오직 추상화된 모듈에만 관심을 가진다. 즉, TC는 객체간 관계에서 클라이언트다.

정확히는, 테스트가 구체적 모듈에 관심을 가지는 순간 아예 쓸모없는 TC가 되어버린다. 왜 일까? 구체적 모듈은 항상 바뀐다. 당연하다. 효율성을 위해서건 버전업을 하던 끊임없이 수정 혹은 리팩토링된다. 여기에 대해 TC가 관심을 가지고 있다면 어떻게 될까? 코드 수정에 종속되어 TC가 바뀐다(!). 구현에 종속되는 테스트? 그 보다 무의미한 코드도 찾기 힘들 것 같다. 테스트의 모든 의미가 사라지고 주인과 노예의 위치가 바뀌는 순간이다. 

결론적으로, 추상 모듈에만 의존하는 테스트라는 것은 권장이 아니라 그 외의 방법들은 쓸모가 없기 때문에 필수인 것이다.

# TC가 유용한 순간들
TC는 점차 쌓이며 모두에게 코드의 논리를 추적하게 해주는 고마운 존재가 되어 준다. 인풋 값을 조절해가며, 계속 새로 컴파일해가며, 역추적해가며 print out해가며 중요 지점들을 체크하는 시간을 크게 줄여줄 수 있다는 것이다. 

또 한 새로 작성된 코드로 인한 사이드 이펙트 발생을 방지해준다. 테스트 한번에 값을 모두 추적할 수 있기에 상술한 내용과 일맥상통하는 얘기다.

개발자들에게 객체에 대한 클라이언트의 입장에서 코드를 바라볼 수 있게 해주는 좋은 시야도 제공해준다. 언제나 인터페이스의 입장에서, 즉 언제나 다형성을 충족하는 설계에서 코드를 인지할 수 있도록 도와준다.

이는 다음에 혹은 함께 코드를 유지하게 될 개발자에게 좋은 설명서가 되어 줄 수도 있다. 아니, 애초에 좋은 테스트는 좋은 설명서이다.

# 불필요한 TC
위의 내용과 정확히 반대되는 경우들이다. 인터페이스를 벗어난 TC들. 구체적 모듈에 의존해버리는 TC들. 커버리지 수치를 위한 TC들.
가장 위험한, Green에 중독된 무의미한 TC들.
이런 TC들은 개발에 어떠한 지표도 되어주지 못할 뿐 아니라 다른 개발자들에게 까지 짐이 되는 최악의 TC들이다.

