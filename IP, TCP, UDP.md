# 1. TCP/IP
TCP/IP 는 지역네트워크(LAN) 혹은 광역네트워크(WAN)에서 원할한 통신을 가능하도록 하기 위한 통신규약(Protocol) 으로 정의할 수 있다. 최초 미국방성에서 구축한 ARPANET에서 시작되었으며, 후에 미국방위통신청(DAC-Defense Communication Agency)에서 컴퓨터간 통신을 위해서 TCP/IP를 사용하도록 한것이 그 시초가 되었다. 가장 인기있는 인터넷 서비스인 WWW, EMAIL, TELNET, FTP등 대부분이 TCP/IP 기반에서 만들어져있다. 인터넷으로 연결된 수많은 컴퓨터와 통신을 위해서 TCP/IP를 선택한 이유는 그 개방성에 있다. 즉 하드웨어, 운영체제, 접속매체에 관계없이 동작할수 있다는점때문에, 인터넷 통신을 위한 핵심으로 선택되었다. 현재 존재하는 상당수의 인터넷 서비스는 TCP/IP위에서 동작한다고 볼 수 있다. 

# 2. IP
인터넷 프로토콜(Internet Protocol)의 약자로 흔히는 이 프로토콜에서 각 장치를 나타내는 IP 주소를 가리키는 말로 쓰인다.각 장치들의 주민등록번호라고 생각하면 쉽다. 
컴퓨터의 경우 사용하는 운영체제도 서로 다르고, 프로그램의 경우 아예 구현된 언어가 다르기 때문에 네트워크에서 이들이 통신할 수 있도록 하려면 공통된 통신 규약(프로토콜)이 필요하다. 컴퓨터 통신의 태동기였던 1960년대에는 장비 제조사마다 각기 다른 프로토콜을 사용하고 있었고, 다른 회사의 장비 사이에는 통신이 힘들거나 아예 불가능했다. 이 때문에 관련 프로토콜을 국제적으로 표준화하기 위한 ISO 위원회가 발족되었고, 1977년에 OSI 7계층 모델을 발표한다. IP를 통하지 않고 현 인터넷을 통해 통신한다는 건 불가능하기 때문에 매우 중요한 개념이다. LAN 환경 등에서는 MAC 주소 기반 통신이 필요한 경우도 있는 등, IP가 만능은 아니다.

## 2-1. IPv4와 IPv6
IP주소는 IPv4, IPv6 2가지 종류가 있으며, 일반적으로 IP 주소라 하면 IPv4 주소를 말한다.
IPv4는 IP version 4의 약자로 전 세계적으로 사용된 첫 번째 인터넷 프로토콜이다. 주소는 32비트 방식으로, 8비트씩 4자리로 되어 있으며 각 자리는 온점으로 구분한다(ex: 115.68.24.88).
IPv4는 0 ~ 2^32 (약 42억 9천)개의 주소를 가질 수 있는데, 전 세계적으로 인터넷 사용자 수가 급증하면서 IPv4 주소가 고갈될 위기에 처해있다. 이러한 고갈 문제를 해결하기 위해 등장한 주소가 바로 IPv6이다. 128비트의 값을 가지며 일반적으로 4자리의 16진수 숫자 8개로 표기하고, 각각은 쌍점(:)으로 구분한다. IPv6은 IPv4 주소의 고갈을 앞두고 차기 주소 체계로서 고안되었으며, 조금씩 적용 사례가 늘고 있다. IPv4의 이론상 주소 수는 232개인 반면, IPv6의 최대 할당 IP 개수는 2128(약 3.4 x 1038)개 주소를 가질 수 있으므로 통신이 가능한 기기마다 공인 IP를 하나씩 할당해도 고갈될 걱정이 없다. 기존의 주소체계를 변경하는데 비용이 많이 들어서 아직 완전히 상용화가 되지 않았다. 2021년 3월 21일 기준 한국의 IPv6 점유율은 20%로 지지부진 한 상태이다.

## 2-2. 고정IP와 유동IP
고정 IP는 말 그대로 변하지 않고 컴퓨터에 고정적으로 부여된 IP이다. 한번 부여되면 IP 반납을 하기 전까지는 다른 장비에 부여할 수 없는 고유의 IP로 보안성이 우수하기 때문에 보안이 필요한 업체나 기관에서 사용한다. 유동 IP 역시 말그대로 변하는 IP이다. 인터넷 사용자 모두에게 고정 IP를 부여해 주기는 힘들기 때문에, 일정한 주기 또는 사용자들이 인터넷에 접속하는 매 순간마다 사용하고 있지 않은 IP 주소를 임시로 발급해 주는 IP이다. 대부분의 사용자는 유동 IP를 사용한다.

## 2-3. 공인IP와 사설IP
IP 주소는 임의로 우리가 부여하는 것이 아니라 전 세계적으로 ICANN이라는 기관이 국가별로 사용할 IP 대역을 관리하고, 우리나라는 한국인터넷진흥원(KISA)에서 국내 IP 주소들을 관리하고 있다. 이것을 ISP(Internet Service Provider의 약자로 KT, LG, SKT와 같이 인터넷을 제공하는 통신업체)가 부여받고, 우리는 위 회사에 가입을 통해 IP를 제공받아 인터넷을 사용하게 되는 것이다. 이렇게 발급받은 IP를 공인 IP라고 한다.

공유기를 사용한 인터넷 접속 환경일 경우 공유기까지는 공인 IP 할당을 하지만, 공유기에 연결되어 있는 가정이나 회사의 각 네트워크 기기에는 사설 IP를 할당한다. 사설 IP는 어떤 네트워크 안에서 내부적으로 사용되는 고유한 주소이다.

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FpA7qY%2FbtqAM3A3Tva%2FIcMITLPilsz4k4rcUDTsgk%2Fimg.png" width="50%" height="50%">

즉, 공인 IP는 전 세계에서 유일하지만, 사설 IP는 하나의 네트워크 안에서 유일하다. 공인 IP는 외부, 내부 상관없이 해당 IP에 접속할 수 있으나, 사설 IP는 내부에서만 접근이 가능하다.

### 참조) MAC(Media Access Control) address란?
고유한 주소를 부여해서 통신이 가능하도록 만든 일종의 하드웨어 주소이다. IP주소와 혼동될 수 있는데, 통신을 위해선 IP주소와 MAC주소가 모두 필요하다. OSI 7 계층에 따른 표준에 따라 통신 절차가 진행되기 때문인데, IP주소는 3계층인 네트워크 계층에서 사용되지만 MAC주소는 2계층인 데이터링크 계층에서 사용되기 때문이다. IP주소에서 MAC주소로 서로 변환하는 과정을 ARP(Address Resolution Protocol)이라고 한다. 통신을 위한 모든 랜카드에는 고유한 MAC주소가 있다. 통신은 그 중간과정에서 수많은 IP<->MAC 변환 과정을 거친다. 결론적으로 MAC은 통신할 하드웨어 장비를 식별할 수 있는 고유 주소이며 일반적으로 우리가 알고 있는 랜카드 당 하나의 MAC주소가 부여된다. 48비트 길이이나, 지나치게 길어 16진수로 나눠표시하는데 앞 6자리는 OUI(Organiztional Unique Identifier)로 제조사를 식별 할 수있고, 나머지 6자리는 '호스트 식별자'라고 하여 각 제조사에서 임의로 붙이는 시리얼 넘버의 개념이다.

# 3. TCP
TCP(Transmission Control Protocol)는 세계 통신표준으로 개발된 OSI 모형에서 4번째 계층인 전송 계층에서 사용하는 규약으로, 보통 3 계층인 네트워크 계층에서 사용하는 IP와 엮어서 TCP/IP로 표현하는 경우가 많다. 동일 계층에서 사용하는 또 다른 프로토콜로 UDP가 존재한다. TCP의 개발 동기는 군사적인 목적과도 닿아있다. 미국 국방부 산하의 고등 연구국에서 ARPANET을 연구할 때 관심을 가진 주제가 적국의 폭격, 심지어 핵전쟁이 발발하더라도 죽지 않고 정상적으로 동작하는 네트워크였다. 당시 일반적으로 사용되던 통신방식은 회선교환(Circuit Switching) 방식이었다. 이는 통신 경로를 미리 정해놓는 방식으로서, 경로가 파괴되면 즉시 통신이 단절되는 전략적 약점이 존재했다. 이에 따라 개발된 것이 패킷교환(Packet Switching) 방식이다.

TCP를 통해 분할된 데이터는 고유 번호가 부여되며, 전송받은 패킷의 순서에 대한 정보가 있고 데이터 누락을 방지하도록 설계되어 데이터 신뢰성이 높게 작동한다. 흐름제어와 혼잡제어를 통해 통신 가능성을 높인다.

## 3-1. 패킷 교환(데이터그램 방식과 회선 교환 방식)
패킷 교환(Packet switching)은 컴퓨터 네트워크와 통신의 방식 중 하나로 현재 가장 많은 사람들이 사용하는 통신 방식이다. 작은 블록의 패킷으로 데이터를 전송하며 데이터를 전송하는 동안만 네트워크 자원을 사용하도록 하는 방법을 말한다. 정보 전달의 단위인 패킷은 여러 통신 지점(Node)을 연결하는 데이터 연결 상의 모든 노드들 사이에 개별적으로 경로가 제어된다. 이 방식은 통신 기간 동안 독점적인 사용을 위해 두 통신 노드 사이를 연결하는 회선 교환 방식과는 달리 짤막한 데이터 트래픽에 적합하다. 

데이터그램 방식에서는 개별 데이터는 발신지 주소, 목적지 주소가 추가되어 하나의 단일한 패킷이 된다. 이런 패킷들의 나열(sequence)는 차례로 목적지까지 보내지고, 목적지에서는 이런 패킷 나열을 다시 원본 파일로 재구성하는 작업이 이루어진다. 각 패킷은 개별적으로 경로가 제어(라우팅)된다. 회선 교환 방식과의 차이는 단순히 연결되어 있다는 것만 보장한다는 점이다.

회선 교환망(전화)에서도 회선의 경로를 찾기 위해서 마찬가지로 경로제어를 수행한다. 그러나 회선교환 네트워크에서는 일단 경로가 설정되면 데이터를 패킷으로 나누지도 않고 개별적으로 경로를 제어하지도 않는다. 그저 이전 경로를 따라 지속적이고 안정적으로 전송한다.  

*데이터 그램 방식의 패킷 교환  

![패킷 교환](https://thumbs.gfycat.com/GlamorousCharmingBallpython-small.gif)

**데이터그램 교환방식에 TCP와 User Datagram Protocol 즉, UDP가 모두 포함된다. 데이터그램방식 = User Datagram Protocol 이 아니므로 오해가 없도록 한다.

## 3-2. 연결 지향이란
TCP는 UDP와 달리 연결지향이다. 데이터가 전송되기전에, Browser 와 Server 간의 연결을 성립하는 과정이 데이터를 전송하는 과정전에 이루어지게 된다. Browser와 Server는 정식 데이타를 교환하기 위한 통신선로를 개설하게 된다.

<img src="http://lh6.ggpht.com/_Os5qf5urx_A/S6uTJRx1y3I/AAAAAAAABQo/O428v-3M8xc/s800/d8495.png" width="50%" height="50%">  
1. Browser -> Server : 서버의 통신가능 여부를 확인한다(SYN). 

2. Server -> Browser : 서버가 준비됐으니 데이터를 전송하라는 신호를 보낸다(SYN-ACK).

3. Browser -> Server : 데이터를 전송하겠다는 신호를 보낸다(ACK).

통신선로를 하나 만들기 위해서는 3번의 데이타 전송이 일어나게 되므로, 이것을 three way handshake이라고 한다. 

### 참고) 패킷(packet)이란?
  인터넷 내에서 데이터를 보내기 위한 경로배정(라우팅)을 효율적으로 하기 위해서 데이터를 여러 개의 조각들로 나누어 전송을 하는데 이때, 이 조각을 패킷이라고 한다.
  
### 참고) 흐름제어(Flow Control)와 혼잡제어(Congestion Control)이란?
흐름제어는 데이터를 송신하는 곳과 수신하는 곳의 데이터 처리 속도를 조절하여 수신자의 버퍼 오버플로우를 방지하는 것이다. 예를 들어 송신하는 곳에서 감당이 안되게 데이터를 빠르게 많이 보내면 수신자에서 문제가 발생하기 때문이다. 혼잡제어는 네트워크 내의 패킷 수가 넘치게 증가하지 않도록 방지하는 것이다. 만약 정보의 소통량이 과다하면 패킷을 조금만 전송하여 혼잡 붕괴 현상이 일어나는 것을 막는다. 데이터를 보내고, 데이터를 받았다는 확인을 거치지 못하면 데이터 전송량을 대폭 줄인다. 반대로 확인이 오면 조금씩 전송량을 늘리는 방식이다.

# 4. OSI 7 계층과 TCP/IP 4 계층

<img src="https://media.vlpt.us/images/gparkkii/post/5b82f13c-e62f-4c37-afae-8059154b897b/F3C5A0A2-62C3-4BAE-8266-F9FFCFC2EBBF.png" width="70%" height="70%">

## 4-1. OSI 7 계층  
| 계층 | 설명 |
| ----- | --- |
| 물리계층 | 실제 장치들을 연결하기 위해 필요한 전기적, 물리적 세부 사항들을 정의한다. 네트워크상에서 데이터 비트를 전송하는 계층이다. (단위: bit) |
| 데이터 링크 계층 |  Point to Point 간 신뢰성 있는 전송을 보장하기 위한 계층으로 순환 중복 검사(CRC) 기반의 오류 제어와 흐름 제어가 필요하다. 네트워크 위의 개체들 간 데이터를 전달하고, 물리 계층에서 발생할 수 있는 오류를 찾아 내고 수정하는 데 필요한 수단을 제공한다. 데이터 링크 계층의 예는 이더넷이다. (단위: freame) |
| 네트워크 계층 | 여러 개의 노드를 거칠 때마다 경로를 찾아주는 역할을 하는 계층으로, 그 과정에서 전송 계층이 요구하는 서비스 품질(QoS)을 제공하기 위한 수단을 제공한다. 네트워크 계층은 라우팅, 패킷 포워딩, 세그멘테이션(과 desegmentation), 인터네트워킹 등을 수행한다. 라우터가 이 계층에서 동작하고 이 계층에서 동작하는 스위치도 있다. 데이터를 네트워크를 통해 전달함으로써 인터넷이 가능하게 만드는 계층이다. 논리적인 주소 구조(★IP), 즉 네트워크 관리자가 직접 주소를 할당하는 구조를 가지며, 계층적이다. (단위: packet)|
| 전송계층 | 사용자들이 신뢰성있는 데이터를 주고 받을 수 있도록 해준다. 시퀀스 넘버 기반의 오류 제어 방식을 사용한다. 연결의 유효성을 제어하고, 일부 프로토콜은 상태 개념이 있고(stateful), 연결 기반이다. 이는 전송 계층이 패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷들을 다시 전송한다는 것을 뜻한다. 오류검출 및 복구와 흐름제어, 중복검사 등을 수행한다. TCP와 UDP등이 있다.|
| 세션 계층 | 양 끝단의 응용 프로세스가 통신을 관리하기 위한 방법을 제공한다. 이 계층은 TCP/IP 세션을 만들고 없애는 책임을 진다. 통신하는 사용자들을 동기화하고 오류복구 명령들을 일괄적으로 다룬다. | 
| 표현 계층 | 코드간의 번역으로 사용자의 시스템에서 데이터의 형식상 차이를 다루는 부담을 응용 계층으로부터 덜어 준다. 인코딩이나 암호화 등의 동작이 이 계층에서 이루어진다(ex: EBCDIC > ASCII). |
| 응용 계층 | 응용 계층은 응용 프로세스와 직접 관계하여 일반적인 응용 서비스를 수행한다. WWW를 위한 HTTP 는 L7 에서 동작하는 프로토콜이다. Message 또는 Data 단위|


## 4-2. TCP/IP 4계층  
| 계층 | 설명 |
| --- | --- |
| 어플리케이션 계층(HTTP 등) | 사용자 응용 프로그램으로 부터 요청을 받아 이를 적절한 메시지로 변환하고 하위 계층으로 전달한다 |
| 전송계층(TCP, UDP) | IP에 의해 전달되는 패킷의 오류를 검사하고 통신 노드간의 제어 및 자료의 송수신을 담당한다 |
| 인터넷 계층(IP) | 통신 노드 간의 IP패킷을 전송하는 기능 및 라우팅 기능을 담당한다 |
| 네트워크 인터페이스 또는 데이터 링크 계층(LAN, 패킷 망) | 이더넷 카드 등으로 연결된 물리적인 네트워크들을 의미한다 |

# 5. Ethernet
이더넷은 LAN(Local Area Network)를 위해 개발된 근거리 유선 네트워크 통신망 기술로 IEEE 802.3에 표준으로 정의 되어있다. OSI 모델의 물리 계층에서 신호와 배선, 데이터 링크 계층에서 MAC(media access control) 패킷과 프로토콜의 형식을 정의한다. 현재 가장 널리 사용되고 있으며, 토큰 링, FDDI 등의 다른 표준을 대부분 대체했다. 네트워크에 연결된 각 기기들이 48비트 길이의 고유의 MAC 주소를 가지고 이 주소를 이용해 상호간에 데이터를 주고 받을 수 있도록 만들어졌다.
## 5-1. CSMA/CD
이더넷은 CSMA/CD (carrier sense multiple access with collision detection 반송파 감지 다중 접속 및 충돌 탐지) 기술을 사용한다. 
이 기술은 이더넷에 연결된 여러 컴퓨터들이 하나의 전송 매체를 공유할 수 있도록 한다.

이더넷 네트워크를 사용하는 경우 다음과 같은 과정을 거친다.
1. 네트워크를 사용하려는 컴퓨터는 먼저 현재 네트워크 위에 흐르고 있는 데이터가 있는지를 감지한다.  
2. 만약 현재 다른 데이터가 전송 중이면 사용할 수 있을 때까지 기다리고 아니면 전송을 시작한다.  
3. 여러 군데에서 동시에 전송을 시작해 충돌이 발생하면 최소 패킷 시간 동안 전송을 계속해, 다른 컴퓨터가 충돌을 탐지할 수 있도록 한다.  
4. 그 뒤, 임의 시간 동안 기다린 뒤에 다시 신호(반송파)를 감지하고, 네트워크 사용자가 없으면 전송을 다시 시작한다.  
5. 전송을 마치면, 상위 계층에 전송이 끝났음을 알리고 끝마친다.  
6. 여러 번 다시 시도했음에도 전송에 실패하면 이를 상위 계층에 알리고 끝마친다.  

너무 많은 충돌이 발생할 경우, 통신 자체가 불가능 해질 수 있다.
오늘날에는 대부분 이더넷 스위치를 사용하여 스위치 방식의 네트워크(switched network)를 구성하는데, 이 경우 충돌이 일어나지 않는다.

### 참고) LAN과 WAN
<img src="http://lh5.ggpht.com/_Os5qf5urx_A/S6uTJW742tI/AAAAAAAABQk/egP74kF-ZCA/s800/99595.png" width="40%" height="40%">
LAN : 비교적 근거리 통신망을 의미한다. 연결 형식에 따라 링, 버스, 스타 세가지 Topology형태로 구분된다.  

WAN : 여러개의 LAN이 모여 이루는 지역, 국가 등 넓은 범위의 통신망이다. 둘 이상의 LAN이 소통하기 위해선 Router가 필요하며, Router간의 연결을 inter-networking(OSI 3 계층)이라고 한다.

# 6. TCP vs UDP  

## 6-1. UDP란?  
UDP(User Datagram Protocol)의 전송 방식은 너무 단순해서 서비스의 신뢰성이 낮고, 데이터그램 도착 순서가 바뀌거나, 중복되거나, 심지어는 통보 없이 누락시키기도 한다. UDP는 일반적으로 오류의 검사와 수정이 필요 없는 애플리케이션에서 수행할 것으로 가정한다.

## 6-2. UDP는 왜 사용하는가?
예를 들어, TCP의 장점인 손실무효화는 실시간 스트리밍 서비스에서는 걸림돌로 작용한다. 전체 영상에서 점 하나 못 받은 것 때문에 버퍼링 돌린다고 재생이 중지되거나, 혼잡제어를 위해 보내는 양까지 조절하기 때문에 영상 퀄리티가 안정적이지 못했다.

이러한 비효율성을 해결하기 위하여 제시된 것이 UDP이다.

매커니즘이 정해져있어서 손을 댈 수 없는 TCP 기반을 더 최적화 하고 싶을 때, TCP는 그대로 두고 UDP를 이용해서 어플리케이션 레벨에서 만들어내면 된다.

<img src="https://blog.kakaocdn.net/dn/csLXm8/btqzttm3Ntc/EMbBrxFEBmQ0jMsuXr64P0/img.png" width="70%" height="70%">  
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcOn9Mu%2FbtqCLMk1DSM%2Fp6rV91JbfCa4I136YjyKik%2Fimg.png "width="40%" height="40%">  
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdAFbbs%2FbtqCO0I111S%2Fed63wVTWv1KzUp5t7DSZ11%2Fimg.png "width="40%" height="40%">  

# References:  
[TCP vs UDP](https://mangkyu.tistory.com/15)  
[TCP/IP 개론](https://www.joinc.co.kr/w/Site/Network_Programing/Documents/IntroTCPIP)  
[인터넷 네트워크 : TCP/UDP](https://velog.io/@gparkkii/HTTPTCPUPD)  
[개알못을 위한 TCP/IP의 개념](https://brunch.co.kr/@wangho/6)  
[IP란 무엇인가](https://study-recording.tistory.com/7)  
[나무위키 IP](https://namu.wiki/w/IP)  
[나무위키 TCP](https://namu.wiki/w/TCP)  
[나무위키 OSI 7계층](https://namu.wiki/w/OSI%20%EB%AA%A8%ED%98%95)  
[패킷교환](https://ko.wikipedia.org/wiki/%ED%8C%A8%ED%82%B7_%EA%B5%90%ED%99%98)
